<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="welcome-section">
      <div class="user-greeting">
        <h1 class="welcome-title">{{ welcomeMessage() }}</h1>
        <p class="user-role">{{ userRoleDisplay() }}</p>
      </div>

      <div class="header-actions">
        <button class="btn btn-secondary" (click)="onRefreshData()" [disabled]="isLoading()">
          <svg class="btn-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
          </svg>
          Refresh
        </button>
      </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading-overlay" *ngIf="isLoading()">
      <div class="loading-spinner">
        <svg width="24" height="24" viewBox="0 0 24 24">
          <path fill="currentColor" d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"/>
          <path fill="currentColor" d="M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z"/>
        </svg>
      </div>
    </div>
  </div>

  <!-- Stats Cards Grid -->
  <div class="stats-grid">
    <div class="stat-card" data-cy="total-plans-stat">
      <div class="stat-header">
        <div class="stat-icon stat-icon-blue">
          <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
          </svg>
        </div>
        <h3 class="stat-title">Total Plans</h3>
      </div>
      <div class="stat-value">{{ dashboardStats().totalPlans }}</div>
      <div class="stat-description">Subscription plans configured</div>
    </div>

    <div class="stat-card" data-cy="active-widgets-stat">
      <div class="stat-header">
        <div class="stat-icon stat-icon-green">
          <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
          </svg>
        </div>
        <h3 class="stat-title">Active Widgets</h3>
      </div>
      <div class="stat-value">{{ dashboardStats().activeWidgets }}</div>
      <div class="stat-description">Pricing widgets deployed</div>
    </div>

    <div class="stat-card" data-cy="marketing-campaigns-stat">
      <div class="stat-header">
        <div class="stat-icon stat-icon-purple">
          <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
          </svg>
        </div>
        <h3 class="stat-title">Marketing Campaigns</h3>
      </div>
      <div class="stat-value">{{ dashboardStats().marketingCampaigns }}</div>
      <div class="stat-description">Active A/B tests & campaigns</div>
    </div>

    <div class="stat-card" data-cy="team-members-stat">
      <div class="stat-header">
        <div class="stat-icon stat-icon-orange">
          <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
            <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
          </svg>
        </div>
        <h3 class="stat-title">Team Members</h3>
      </div>
      <div class="stat-value">{{ dashboardStats().teamMembers }}</div>
      <div class="stat-description">Active team collaborators</div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="main-content-grid">
    <!-- Quick Actions Section -->
    <div class="quick-actions-section">
      <div class="section-header">
        <h2 class="section-title">Quick Actions</h2>
        <p class="section-description">Common tasks for your role</p>
      </div>

      <div class="quick-actions-grid">
        <a
          *ngFor="let action of quickActions()"
          [routerLink]="action.route"
          class="quick-action-card"
          [class]="'action-' + action.color"
          (click)="onQuickActionClick(action)"
          [attr.data-cy]="'quick-action-' + action.label.toLowerCase().replace(' ', '-')">
          <div class="action-icon">
            <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
              <!-- Dynamic icon based on action.icon -->
              <path *ngIf="action.icon === 'users'" d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
              <path *ngIf="action.icon === 'settings'" fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
              <path *ngIf="action.icon === 'shield'" fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              <path *ngIf="action.icon === 'trending-up'" fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
              <path *ngIf="action.icon === 'bar-chart'" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
              <path *ngIf="action.icon === 'target'" fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
              <path *ngIf="action.icon === 'code'" fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
              <path *ngIf="action.icon === 'package'" fill-rule="evenodd" d="M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-1 1v3a1 1 0 11-2 0V6z" clip-rule="evenodd"/>
              <path *ngIf="action.icon === 'terminal'" fill-rule="evenodd" d="M3 5a2 2 0 012-2h10a2 2 0 012 2v8a2 2 0 01-2 2h-3.22l.123.149.006.007A1 1 0 0111.5 17H6.22l.123-.149.006-.007A1 1 0 016 16a1 1 0 00-.123.149l-.006.007A1 1 0 015.5 17h-.278a1 1 0 01-.847-1.529l.131-.155A3 3 0 015 13V5z" clip-rule="evenodd"/>
              <path *ngIf="action.icon === 'layout'" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
              <path *ngIf="action.icon === 'help-circle'" fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
            </svg>
          </div>
          <span class="action-label">{{ action.label }}</span>
        </a>
      </div>
    </div>

    <!-- Recent Activities Section -->
    <div class="recent-activities-section">
      <div class="section-header">
        <h2 class="section-title">Recent Activities</h2>
        <p class="section-description">Latest updates and changes</p>
      </div>

      <div class="activities-list" *ngIf="recentActivities().length > 0; else noActivities">
        <div
          *ngFor="let activity of recentActivities()"
          class="activity-item"
          [attr.data-cy]="'activity-' + activity.type">
          <div class="activity-icon" [class]="'activity-icon-' + getActivityColor(activity.status)">
            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
              <!-- Dynamic icon based on activity type -->
              <path *ngIf="getActivityIcon(activity.type) === 'layers'" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
              <path *ngIf="getActivityIcon(activity.type) === 'grid'" d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
              <path *ngIf="getActivityIcon(activity.type) === 'trending-up'" fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
              <path *ngIf="getActivityIcon(activity.type) === 'users'" d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
            </svg>
          </div>

          <div class="activity-content">
            <div class="activity-header">
              <h4 class="activity-title">{{ activity.title }}</h4>
              <span class="activity-time">{{ formatTimeAgo(activity.timestamp) }}</span>
            </div>
            <p class="activity-description">{{ activity.description }}</p>
            <div class="activity-status" [class]="'status-' + activity.status">
              {{ activity.status | titlecase }}
            </div>
          </div>
        </div>
      </div>

      <ng-template #noActivities>
        <div class="empty-state">
          <svg class="empty-icon" width="48" height="48" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
          </svg>
          <h3>No recent activities</h3>
          <p>Start by creating your first plan or widget</p>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Welcome Tour (for first-time users) -->
  <div class="welcome-tour" *ngIf="!currentUser()?.hasCompletedTour">
    <div class="tour-content">
      <div class="tour-header">
        <h3>Welcome to MarketSaaS!</h3>
        <button class="tour-close" aria-label="Close tour">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
        </button>
      </div>
      <div class="tour-body">
        <p>Get started with these essential steps:</p>
        <ul class="tour-steps">
          <li>✓ Set up your first subscription plan</li>
          <li>✓ Create pricing widgets for your website</li>
          <li>✓ Invite team members to collaborate</li>
          <li>✓ Launch your first marketing campaign</li>
        </ul>
      </div>
      <div class="tour-actions">
        <button class="btn btn-primary">Start Tour</button>
        <button class="btn btn-secondary">Skip</button>
      </div>
    </div>
  </div>
</div>
